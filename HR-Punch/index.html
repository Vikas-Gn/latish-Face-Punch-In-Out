<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Attendance Portal</title>
    <style>
        /* Main variables for consistent colors */
:root {
    --primary-color: #4a6baf;
    --primary-light: #6d8fd3;
    --primary-dark: #36508c;
    --accent-color: #ff9a3c;
    --success-color: #4caf50;
    --danger-color: #f44336;
    --warning-color: #ff9800;
    --info-color: #2196f3;
    --text-color: #333333;
    --text-light: #767676;
    --bg-color: #f9fbff;
    --card-bg: #ffffff;
    --border-color: #e0e0e0;
    --shadow-sm: 0 2px 5px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 10px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.12);
    --transition-speed: 0.3s;
    --border-radius: 8px;
}

/* Global Reset & Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    line-height: 1.6;
    transition: background-color 0.5s ease;
}

/* Container */
.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    animation: fadeIn 0.6s ease-out;
}

/* Header */
h1 {
    color: var(--primary-color);
    text-align: center;
    margin: 20px 0 30px 0;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--primary-light);
    position: relative;
    font-weight: 600;
    letter-spacing: 0.5px;
    animation: slideInFromTop 0.8s ease-out;
    background: linear-gradient(to right, var(--primary-color), var(--primary-light));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

h1::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 50%;
    width: 100px;
    height: 2px;
    background-color: var(--accent-color);
    transform: translateX(-50%);
    animation: grow 1s ease-out forwards;
}

@keyframes slideInFromTop {
    from {
        opacity: 0;
        transform: translateY(-30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes grow {
    from {
        width: 0;
    }
    to {
        width: 100px;
    }
}

@media screen and (max-width: 768px) {
    h1 {
        font-size: 1.5rem;
    }
}

@media screen and (max-width: 480px) {
    h1 {
        font-size: 1.2rem;
    }
}

/* Search Container */
.search-container {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 20px;
    margin-bottom: 30px;
    box-shadow: var(--shadow-md);
    transition: all var(--transition-speed) ease;
    animation: slideInFromLeft 0.8s ease-out;
}

.search-container:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
}

.search-row {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    align-items: flex-end;
}

.search-group {
    flex: 1;
    min-width: 200px;
}

.search-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--primary-dark);
    transition: color var(--transition-speed) ease;
}

.search-group:hover label {
    color: var(--primary-color);
}

input[type="text"],
input[type="date"] {
    width: 100%;
    padding: 12px 15px;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    font-size: 14px;
    transition: all var(--transition-speed) ease;
    background-color: rgba(255, 255, 255, 0.9);
}

input[type="text"]:focus,
input[type="date"]:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(74, 107, 175, 0.2);
}

input[type="text"]::placeholder {
    color: var(--text-light);
    opacity: 0.7;
}

/* Buttons */
.btn {
    padding: 12px 20px;
    border: none;
    border-radius: var(--border-radius);
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-speed) ease;
    position: relative;
    overflow: hidden;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
}

.btn::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 5px;
    height: 5px;
    background: rgba(255, 255, 255, 0.5);
    opacity: 0;
    border-radius: 100%;
    transform: scale(1, 1) translate(-50%);
    transform-origin: 50% 50%;
}

.btn:hover::after {
    animation: ripple 0.6s ease-out;
}

@keyframes ripple {
    0% {
        transform: scale(0, 0);
        opacity: 0.5;
    }
    100% {
        transform: scale(20, 20);
        opacity: 0;
    }
}

.clear-btn {
    background-color: #f5f5f5;
    color: var(--text-color);
}

.clear-btn:hover {
    background-color: #e0e0e0;
}

.danger-btn {
    background-color: var(--danger-color);
    color: white;
}

.danger-btn:hover {
    background-color: #d32f2f;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(244, 67, 54, 0.3);
}

.primary-btn {
    background-color: var(--primary-color);
    color: white;
}

.primary-btn:hover {
    background-color: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(74, 107, 175, 0.3);
}

.cancel-btn {
    background-color: #f5f5f5;
    color: var(--text-color);
}

.cancel-btn:hover {
    background-color: #e0e0e0;
}

.view-btn {
    background-color: var(--info-color);
    color: white;
    padding: 8px 16px;
    font-size: 13px;
}

.view-btn:hover {
    background-color: #0b7dda;
    transform: translateY(-2px);
}

/* Records Container */
.records-container {
    background-color: var(--card-bg);
    border-radius: var(--border-radius);
    padding: 20px;
    box-shadow: var(--shadow-md);
    transition: all var(--transition-speed) ease;
    animation: slideInFromRight 0.8s ease-out;
}

.records-container.filtered {
    animation: pulse 0.5s ease-out;
}

/* Table Styling */
table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
    background-color: white;
    box-shadow: var(--shadow-sm);
    border-radius: var(--border-radius);
    overflow: hidden;
}

thead {
    background-color: var(--primary-color);
    color: white;
}

th {
    padding: 15px;
    text-align: left;
    font-weight: 500;
    position: relative;
}

th:after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: var(--primary-light);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

thead:hover th:after {
    transform: scaleX(1);
}

td {
    padding: 12px 15px;
    border-bottom: 1px solid var(--border-color);
}

tbody tr {
    transition: all var(--transition-speed) ease;
}

tbody tr:hover {
    background-color: rgba(74, 107, 175, 0.05);
    transform: scale(1.005);
}

tbody tr:nth-child(even) {
    background-color: #f9fafc;
}

/* Checkbox Styling */
input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: var(--primary-color);
    cursor: pointer;
    transition: all 0.2s ease;
}

input[type="checkbox"]:hover {
    transform: scale(1.1);
}

/* Empty Records */
.empty-records {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-light);
    font-style: italic;
    animation: fadeIn 0.8s ease-out;
}

/* Pagination */
.pagination {
    display: flex;
    justify-content: center;
    gap: 5px;
    margin-top: 20px;
}

.pagination-btn {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--border-color);
    background-color: white;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: all var(--transition-speed) ease;
}

.pagination-btn:hover:not(.disabled):not(.active) {
    background-color: var(--primary-light);
    color: white;
    border-color: var(--primary-light);
    transform: translateY(-2px);
}

.pagination-btn.active {
    background-color: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.pagination-btn.disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Modal Styling */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    overflow: auto;
    animation: fadeIn 0.3s ease-out;
}

.modal-content,
.confirmation-content,
.alert-content {
    background-color: white;
    margin: 50px auto;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-lg);
    width: 90%;
    max-width: 600px;
    transform: translateY(20px);
    opacity: 0;
    transition: all 0.3s ease;
}

.modal-content.show,
.confirmation-content.show,
.alert-content.show {
    transform: translateY(0);
    opacity: 1;
}

.modal-content {
    padding: 30px;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.2s ease;
}

.close:hover {
    color: var(--primary-color);
}

/* Detail Modal */
.detail-container {
    margin: 20px 0;
}

.detail-row {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 20px;
}

.detail-card {
    flex: 1;
    min-width: 200px;
    padding: 15px;
    background-color: #f9fafc;
    border-radius: var(--border-radius);
    border-left: 3px solid var(--primary-color);
    transition: all var(--transition-speed) ease;
}

.detail-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
}

.detail-title {
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px solid var(--border-color);
}

.detail-info {
    margin-bottom: 5px;
    line-height: 1.5;
}

.image-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
}

.image-card {
    flex: 1;
    min-width: 200px;
    padding: 15px;
    background-color: #f9fafc;
    border-radius: var(--border-radius);
    text-align: center;
    transition: all var(--transition-speed) ease;
}

.image-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-2px);
}

.image-title {
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 10px;
}

.attendance-image {
    max-width: 100%;
    height: auto;
    border-radius: var(--border-radius);
    border: 1px solid var(--border-color);
    transition: all var(--transition-speed) ease;
}

.attendance-image:hover {
    transform: scale(1.02);
    box-shadow: var(--shadow-md);
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    margin-top: 20px;
}

/* Confirmation Modal */
.confirmation-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    animation: fadeIn 0.3s ease-out;
}

.confirmation-content {
    padding: 30px;
    text-align: center;
    max-width: 400px;
}

.confirmation-icon {
    font-size: 48px;
    color: var(--warning-color);
    margin-bottom: 20px;
    animation: pulse 1s infinite;
}

.confirmation-title {
    font-size: 22px;
    margin-bottom: 15px;
    color: var(--text-color);
}

.confirmation-text {
    margin-bottom: 30px;
    color: var(--text-light);
}

.confirmation-buttons {
    display: flex;
    justify-content: center;
    gap: 15px;
}

/* Alert Modal */
.alert-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    animation: fadeIn 0.3s ease-out;
}

.alert-content {
    padding: 30px;
    text-align: center;
    max-width: 400px;
}

.alert-icon {
    font-size: 48px;
    color: var(--info-color);
    margin-bottom: 20px;
}

.alert-title {
    font-size: 22px;
    margin-bottom: 15px;
    color: var(--text-color);
}

.alert-message {
    margin-bottom: 30px;
    color: var(--text-light);
}

.alert-buttons {
    display: flex;
    justify-content: center;
}

/* Notification */
.notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    display: flex;
    align-items: center;
    padding: 15px 20px;
    background-color: white;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-lg);
    z-index: 1001;
    opacity: 0;
    transform: translateX(50px);
    transition: all 0.3s ease;
    max-width: 300px;
}

.notification.show {
    opacity: 1;
    transform: translateX(0);
}

.notification-icon {
    margin-right: 15px;
    font-size: 20px;
}

.notification-success {
    border-left: 4px solid var(--success-color);
}

.notification-success .notification-icon {
    color: var(--success-color);
}

.notification-info {
    border-left: 4px solid var(--info-color);
}

.notification-info .notification-icon {
    color: var(--info-color);
}

.notification-message {
    font-size: 14px;
    color: var(--text-color);
}

/* Animations */
@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes slideInFromLeft {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slideInFromRight {
    from {
        opacity: 0;
        transform: translateX(30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slideInFromTop {
    from {
        opacity: 0;
        transform: translateY(-30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes grow {
    from {
        width: 0;
    }
    to {
        width: 100px;
    }
}

@keyframes pulse {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
    100% {
        transform: scale(1);
    }
}

@media screen and (max-width: 480px) {
    .pagination {
        flex-wrap: wrap;
    }
    
    .notification {
        width: 90%;
        left: 5%;
        right: 5%;
    }
}

/* Dark Mode Support (add a class to body to toggle) */
body.dark-mode {
    --bg-color: #1f2937;
    --card-bg: #2d3748;
    --text-color: #e2e8f0;
    --text-light: #a0aec0;
    --border-color: #4a5568;
    --primary-color: #60a5fa;
    --primary-light: #93c5fd;
    --primary-dark: #3b82f6;
}

body.dark-mode input[type="text"],
body.dark-mode input[type="date"] {
    background-color: #374151;
    color: #e2e8f0;
    border-color: #4b5563;
}

body.dark-mode .clear-btn,
body.dark-mode .cancel-btn {
    background-color: #4b5563;
    color: #e2e8f0;
}

body.dark-mode tbody tr:nth-child(even) {
    background-color: #374151;
}

body.dark-mode tbody tr:hover {
    background-color: rgba(96, 165, 250, 0.1);
}

body.dark-mode table,
body.dark-mode .detail-card,
body.dark-mode .image-card {
    background-color: #374151;
}

/* Loading Effects */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 5px solid rgba(74, 107, 175, 0.2);
    border-top-color: var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* Additional Row Animations */
tbody tr {
    animation: fadeInStaggered 0.5s ease-out backwards;
}

@keyframes fadeInStaggered {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

tbody tr:nth-child(1) { animation-delay: 0.1s; }
tbody tr:nth-child(2) { animation-delay: 0.15s; }
tbody tr:nth-child(3) { animation-delay: 0.2s; }
tbody tr:nth-child(4) { animation-delay: 0.25s; }
tbody tr:nth-child(5) { animation-delay: 0.3s; }
tbody tr:nth-child(6) { animation-delay: 0.35s; }
tbody tr:nth-child(7) { animation-delay: 0.4s; }
tbody tr:nth-child(8) { animation-delay: 0.45s; }
tbody tr:nth-child(9) { animation-delay: 0.5s; }
tbody tr:nth-child(10) { animation-delay: 0.55s; }

/* Hover Effects for Cards */
.detail-card::before,
.image-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(74, 107, 175, 0.05);
    border-radius: var(--border-radius);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: -1;
}

.detail-card:hover::before,
.image-card:hover::before {
    opacity: 1;
}

/* Font Awesome Icons for Buttons */
.btn.view-btn::before {
    content: '👁️ ';
    margin-right: 5px;
}

.btn.clear-btn{
    background-color: #0674ce;
    color: white;
}

.btn.clear-btn::before {
    content: '🔄 ';
    margin-right: 5px;
}

.btn.danger-btn::before {
    content: '🗑️ ';
    margin-right: 5px;
}

/* Shimmering Effect for Primary Elements */
h1, .btn.primary-btn, thead {
    background-size: 200% 100%;
    background-image: linear-gradient(to right, var(--primary-color) 0%, var(--primary-light) 50%, var(--primary-color) 100%);
    animation: shimmer 2s infinite;
    background-repeat: no-repeat;
    background-position: 0 0;
}

@keyframes shimmer {
    from {
        background-position: -100% 0;
    }
    to {
        background-position: 100% 0;
    }
}

/* Additional Transition for Empty Records */
.empty-records {
    position: relative;
    overflow: hidden;
}

.empty-records::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 50%;
    height: 100%;
    background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.8), transparent);
    animation: shine 3s infinite;
}

@keyframes shine {
    to {
        left: 200%;
    }
}
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>HR ATTENDANCE PORTAL</h1>
        
        <div class="search-container">
            <div class="search-row">
                <div class="search-group">
                    <label for="search-employee">Employee ID</label>
                    <input type="text" id="search-employee" placeholder="Enter Employee ID (ATS0XXX)">
                </div>
                
                <div class="search-group">
                    <label for="search-date">Date</label>
                    <input type="date" id="search-date">
                </div>
                
                <button id="reset-search-btn" class="btn clear-btn">Reset</button>
                <button id="clear-records-btn" class="btn danger-btn">Clear Records</button>
            </div>
        </div>
        
        <div class="records-container">
            <table id="records-table">
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox" id="select-all-checkbox">
                        </th>
                        <th>Employee ID</th>
                        <th>Date</th>
                        <th>Punch In</th>
                        <th>Punch Out</th>
                        <th>Duration</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="records-body">
                    <!-- Records will be inserted here dynamically -->
                </tbody>
            </table>
            
            <div id="empty-records" class="empty-records">
                No attendance records found.
            </div>
            
            <div id="pagination" class="pagination">
                <!-- Pagination will be inserted here dynamically -->
            </div>
        </div>
    </div>
    
    <!-- Detail Modal -->
    <div id="detail-modal" class="modal">
        <div class="modal-content">
            <span class="close" id="close-detail">×</span>
            <h2>Attendance Details</h2>
            
            <div class="detail-container" id="detail-container">
                <!-- Details will be inserted here dynamically -->
            </div>
            
            <div class="modal-footer">
                <button id="close-detail-btn" class="btn">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal for Clear Records -->
    <div id="confirmation-modal" class="confirmation-modal">
        <div class="confirmation-content">
            <div class="confirmation-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3 class="confirmation-title">Confirm Deletion</h3>
            <p class="confirmation-text">Are you sure you want to delete selected records? This action cannot be undone.</p>
            
            <div class="confirmation-buttons">
                <button id="confirm-delete-btn" class="btn danger-btn">Delete</button>
                <button id="cancel-delete-btn" class="btn cancel-btn">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Alert Modal -->
    <div id="alert-modal" class="alert-modal">
        <div class="alert-content">
            <div class="alert-icon">
                <i class="fas fa-info-circle"></i>
            </div>
            <h3 class="alert-title">Information</h3>
            <p id="alert-message" class="alert-message">Please select at least one record to delete.</p>
            
            <div class="alert-buttons">
                <button id="alert-ok-btn" class="btn primary-btn">OK</button>
            </div>
        </div>
    </div>

    <script>
        // DOM elements
        const searchEmployeeInput = document.getElementById('search-employee');
        const searchDateInput = document.getElementById('search-date');
        const resetSearchBtn = document.getElementById('reset-search-btn');
        const clearRecordsBtn = document.getElementById('clear-records-btn');
        const recordsTable = document.getElementById('records-table');
        const recordsBody = document.getElementById('records-body');
        const emptyRecords = document.getElementById('empty-records');
        const paginationContainer = document.getElementById('pagination');
        const selectAllCheckbox = document.getElementById('select-all-checkbox');
        
        const detailModal = document.getElementById('detail-modal');
        const closeDetailBtn = document.getElementById('close-detail');
        const closeDetailBtnFooter = document.getElementById('close-detail-btn');
        const detailContainer = document.getElementById('detail-container');
        
        const confirmationModal = document.getElementById('confirmation-modal');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
        const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
        
        const alertModal = document.getElementById('alert-modal');
        const alertMessage = document.getElementById('alert-message');
        const alertOkBtn = document.getElementById('alert-ok-btn');
        
        // Variables
        let allAttendanceRecords = [];
        let filteredRecords = [];
        let recordsToDelete = [];
        let currentPage = 1;
        const recordsPerPage = 10;

        // API base URL
        const API_BASE_URL = 'http://13.235.128.250:3081/api';

        // Load attendance records from backend
        async function loadAttendanceRecords() {
            try {
                const employeeId = searchEmployeeInput.value.trim();
                const date = searchDateInput.value;
                
                let query = `${API_BASE_URL}/records`;
                if (employeeId || date) {
                    query += '?';
                    if (employeeId) query += `employeeId=${encodeURIComponent(employeeId)}`;
                    if (employeeId && date) query += '&';
                    if (date) query += `date=${encodeURIComponent(date)}`;
                }
                
                const response = await fetch(query);
                if (!response.ok) {
                    throw new Error('Failed to fetch records');
                }
                
                allAttendanceRecords = await response.json();
                filteredRecords = [...allAttendanceRecords];
                displayRecords();
            } catch (err) {
                console.error('Error fetching records:', err);
                showNotification('Failed to load records', 'info');
            }
        }

        // Format time
        function formatTime(timestamp) {
            if (!timestamp) return 'N/A';
            const date = new Date(timestamp);
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // Calculate duration
        function calculateDuration(punchIn, punchOut) {
            if (!punchIn || !punchOut) return 'N/A';
            
            const start = new Date(punchIn.dateTime);
            const end = new Date(punchOut.dateTime);
            const durationMs = end - start;
            
            if (durationMs < 0) return 'Invalid';
            
            const hours = Math.floor(durationMs / (1000 * 60 * 60));
            const minutes = Math.floor((durationMs % (1000 * 60 * 60)) / (1000 * 60));
            
            return `${hours}h ${minutes}m`;
        }

        // Display records
        function displayRecords() {
            // Clear table
            recordsBody.innerHTML = '';
            recordsToDelete = [];
            selectAllCheckbox.checked = false;
            
            if (filteredRecords.length === 0) {
                recordsTable.style.display = 'none';
                emptyRecords.style.display = 'block';
                paginationContainer.style.display = 'none';
                return;
            }
            
            recordsTable.style.display = 'table';
            emptyRecords.style.display = 'none';
            
            // Calculate pagination
            const totalPages = Math.ceil(filteredRecords.length / recordsPerPage);
            if (currentPage > totalPages) {
                currentPage = 1;
            }
            
            const startIndex = (currentPage - 1) * recordsPerPage;
            const endIndex = Math.min(startIndex + recordsPerPage, filteredRecords.length);
            const paginatedRecords = filteredRecords.slice(startIndex, endIndex);
            
            // Add records to table
            paginatedRecords.forEach(record => {
                const row = document.createElement('tr');
                const recordKey = `${record.employeeId}-${record.date}`;
                
                const punchInTime = record.punchIn ? formatTime(record.punchIn.dateTime) : 'N/A';
                const punchOutTime = record.punchOut ? formatTime(record.punchOut.dateTime) : 'N/A';
                const duration = calculateDuration(record.punchIn, record.punchOut);
                
                row.innerHTML = `
                    <td>
                        <input type="checkbox" class="record-checkbox" data-key="${recordKey}">
                    </td>
                    <td>${record.employeeId}</td>
                    <td>${record.date}</td>
                    <td>${punchInTime}</td>
                    <td>${punchOutTime}</td>
                    <td>${duration}</td>
                    <td>
                        <button class="btn view-btn" data-employee="${record.employeeId}" data-date="${record.date}">View</button>
                    </td>
                `;
                
                recordsBody.appendChild(row);
            });
            
            // Add event listeners to buttons and checkboxes
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const employeeId = this.getAttribute('data-employee');
                    const date = this.getAttribute('data-date');
                    showDetailModal(employeeId, date);
                });
            });
            
            document.querySelectorAll('.record-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const key = this.getAttribute('data-key');
                    const [employeeId, date] = key.split('-');
                    
                    if (this.checked) {
                        recordsToDelete.push({ employeeId, date });
                    } else {
                        recordsToDelete = recordsToDelete.filter(r => 
                            !(r.employeeId === employeeId && r.date === date)
                        );
                        selectAllCheckbox.checked = false;
                    }
                });
            });
            
            // Update pagination
            updatePagination(totalPages);
        }

        // Update pagination controls
        function updatePagination(totalPages) {
            paginationContainer.innerHTML = '';
            
            if (totalPages <= 1) {
                paginationContainer.style.display = 'none';
                return;
            }
            
            paginationContainer.style.display = 'flex';
            
            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.classList.add('pagination-btn');
            prevBtn.innerHTML = '«';
            if (currentPage === 1) {
                prevBtn.classList.add('disabled');
            } else {
                prevBtn.addEventListener('click', () => {
                    currentPage--;
                    displayRecords();
                });
            }
            paginationContainer.appendChild(prevBtn);
            
            // Page buttons
            const maxPages = 5; // Max number of page buttons to show
            let startPage = Math.max(1, currentPage - Math.floor(maxPages / 2));
            let endPage = Math.min(totalPages, startPage + maxPages - 1);
            
            if (endPage - startPage < maxPages - 1) {
                startPage = Math.max(1, endPage - maxPages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.classList.add('pagination-btn');
                pageBtn.textContent = i;
                
                if (i === currentPage) {
                    pageBtn.classList.add('active');
                } else {
                    pageBtn.addEventListener('click', () => {
                        currentPage = i;
                        displayRecords();
                    });
                }
                
                paginationContainer.appendChild(pageBtn);
            }
            
            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.classList.add('pagination-btn');
            nextBtn.innerHTML = '»';
            if (currentPage === totalPages) {
                nextBtn.classList.add('disabled');
            } else {
                nextBtn.addEventListener('click', () => {
                    currentPage++;
                    displayRecords();
                });
            }
            paginationContainer.appendChild(nextBtn);
        }

        // Show detail modal
        function showDetailModal(employeeId, date) {
            // Find the record
            const record = filteredRecords.find(r => r.employeeId === employeeId && r.date === date);
            
            if (!record) return;
            
            // Format date and times
            const formattedDate = new Date(date).toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            const punchInTime = record.punchIn ? new Date(record.punchIn.dateTime).toLocaleTimeString() : 'N/A';
            const punchOutTime = record.punchOut ? new Date(record.punchOut.dateTime).toLocaleTimeString() : 'N/A';
            const duration = calculateDuration(record.punchIn, record.punchOut);
            
            // Format location data
            const punchInLocation = record.punchInLocation 
                ? `Lat: ${record.punchInLocation.latitude.toFixed(6)}, Lon: ${record.punchInLocation.longitude.toFixed(6)}`
                : 'N/A';
            const punchOutLocation = record.punchOutLocation 
                ? `Lat: ${record.punchOutLocation.latitude.toFixed(6)}, Lon: ${record.punchOutLocation.longitude.toFixed(6)}`
                : 'N/A';
            
            // Create detail content
            detailContainer.innerHTML = `
                <div class="detail-row">
                    <div class="detail-card">
                        <div class="detail-title">Employee Information</div>
                        <div class="detail-info"><strong>Employee ID:</strong> ${record.employeeId}</div>
                    </div>
                    
                    <div class="detail-card">
                        <div class="detail-title">Attendance Information</div>
                        <div class="detail-info"><strong>Date:</strong> ${formattedDate}</div>
                        <div class="detail-info"><strong>Punch In:</strong> ${punchInTime}</div>
                        <div class="detail-info"><strong>Punch Out:</strong> ${punchOutTime}</div>
                        <div class="detail-info"><strong>Duration:</strong> ${duration}</div>
                    </div>
                </div>
                <div class="detail-row">
                    <div class="detail-card">
                        <div class="detail-title">Location Information</div>
                        <div class="detail-info"><strong>Punch In Location:</strong> ${punchInLocation}</div>
                        <div class="detail-info"><strong>Punch Out Location:</strong> ${punchOutLocation}</div>
                    </div>
                </div>
                <div class="image-container">
                    ${record.punchInImage ? `
                        <div class="image-card">
                            <div class="image-title">Punch In Image</div>
                            <img src="${record.punchInImage}" class="attendance-image" alt="Punch In">
                        </div>
                    ` : ''}
                    
                    ${record.punchOutImage ? `
                        <div class="image-card">
                            <div class="image-title">Punch Out Image</div>
                            <img src="${record.punchOutImage}" class="attendance-image" alt="Punch Out">
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Show modal with animation
            detailModal.style.display = 'block';
            setTimeout(() => {
                detailModal.querySelector('.modal-content').classList.add('show');
            }, 10);
        }

        // Show confirmation modal
        function showConfirmationModal() {
            if (recordsToDelete.length === 0) {
                showAlertModal('Please select at least one record to delete.');
                return;
            }
            
            // Show modal with animation
            confirmationModal.style.display = 'block';
            setTimeout(() => {
                confirmationModal.querySelector('.confirmation-content').classList.add('show');
            }, 10);
        }
        
        // Show alert modal
        function showAlertModal(message) {
            alertMessage.textContent = message;
            
            // Show modal with animation
            alertModal.style.display = 'block';
            setTimeout(() => {
                alertModal.querySelector('.alert-content').classList.add('show');
            }, 10);
        }

        // Delete records
        async function deleteRecords() {
            if (recordsToDelete.length === 0) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/records`, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ records: recordsToDelete })
                });
                
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.error || 'Failed to delete records');
                }
                
                // Clear selection and reload records
                recordsToDelete = [];
                await loadAttendanceRecords();
                
                // Show success notification
                showNotification('Records deleted successfully', 'success');
            } catch (err) {
                console.error('Delete error:', err);
                showAlertModal(err.message || 'Failed to delete records');
            }
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.classList.add('notification', `notification-${type}`);
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'info-circle'}"></i>
                </div>
                <div class="notification-message">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Filter records based on search input
        async function filterRecords() {
            await loadAttendanceRecords();
            
            // Show animation for results
            const recordsContainer = document.querySelector('.records-container');
            recordsContainer.classList.add('filtered');
            setTimeout(() => {
                recordsContainer.classList.remove('filtered');
            }, 500);
        }

        // Event listeners
        // Auto-search when typing in search fields
        searchEmployeeInput.addEventListener('input', filterRecords);
        searchDateInput.addEventListener('input', filterRecords);
        
        // Handle select all checkbox
        selectAllCheckbox.addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.record-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
                
                const key = checkbox.getAttribute('data-key');
                const [employeeId, date] = key.split('-');
                
                if (this.checked) {
                    // Only add if not already in the array
                    if (!recordsToDelete.some(r => r.employeeId === employeeId && r.date === date)) {
                        recordsToDelete.push({ employeeId, date });
                    }
                } else {
                    recordsToDelete = [];
                }
            });
        });
        
        resetSearchBtn.addEventListener('click', async () => {
            searchEmployeeInput.value = '';
            searchDateInput.value = '';
            filteredRecords = [...allAttendanceRecords];
            currentPage = 1;
            await loadAttendanceRecords();
        });
        
        clearRecordsBtn.addEventListener('click', showConfirmationModal);
        
        closeDetailBtn.addEventListener('click', () => {
            detailModal.querySelector('.modal-content').classList.remove('show');
            setTimeout(() => {
                detailModal.style.display = 'none';
            }, 300);
        });
        
        closeDetailBtnFooter.addEventListener('click', () => {
            detailModal.querySelector('.modal-content').classList.remove('show');
            setTimeout(() => {
                detailModal.style.display = 'none';
            }, 300);
        });
        
        confirmDeleteBtn.addEventListener('click', async () => {
            confirmationModal.querySelector('.confirmation-content').classList.remove('show');
            setTimeout(async () => {
                confirmationModal.style.display = 'none';
                await deleteRecords();
            }, 300);
        });
        
        cancelDeleteBtn.addEventListener('click', () => {
            confirmationModal.querySelector('.confirmation-content').classList.remove('show');
            setTimeout(() => {
                confirmationModal.style.display = 'none';
            }, 300);
        });
        
        alertOkBtn.addEventListener('click', () => {
            alertModal.querySelector('.alert-content').classList.remove('show');
            setTimeout(() => {
                alertModal.style.display = 'none';
            }, 300);
        });
        
        // Close modals when clicking outside
        window.addEventListener('click', (event) => {
            if (event.target === detailModal) {
                detailModal.querySelector('.modal-content').classList.remove('show');
                setTimeout(() => {
                    detailModal.style.display = 'none';
                }, 300);
            }
            if (event.target === confirmationModal) {
                confirmationModal.querySelector('.confirmation-content').classList.remove('show');
                setTimeout(() => {
                    confirmationModal.style.display = 'none';
                }, 300);
            }
            if (event.target === alertModal) {
                alertModal.querySelector('.alert-content').classList.remove('show');
                setTimeout(() => {
                    alertModal.style.display = 'none';
                }, 300);
            }
        });
        
        // Load records on page load
        loadAttendanceRecords();
        
        // Add notifications for initial page load
        setTimeout(() => {
            showNotification('Welcome to HR Attendance Portal', 'info');
        }, 1000);
    </script>
</body>
</html>